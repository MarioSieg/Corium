// Author: Mario Sieg
// Project: Corium
//
//                                  Apache License
//                            Version 2.0, January 2004
//                         http://www.apache.org/licenses/
//
//    TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION
//
//    1. Definitions.
//
//       "License" shall mean the terms and conditions for use, reproduction,
//       and distribution as defined by Sections 1 through 9 of this document.
//
//       "Licensor" shall mean the copyright owner or entity authorized by
//       the copyright owner that is granting the License.
//
//       "Legal Entity" shall mean the union of the acting entity and all
//       other entities that control, are controlled by, or are under common
//       control with that entity. For the purposes of this definition,
//       "control" means (i) the power, direct or indirect, to cause the
//       direction or management of such entity, whether by contract or
//       otherwise, or (ii) ownership of fifty percent (50%) or more of the
//       outstanding shares, or (iii) beneficial ownership of such entity.
//
//       "You" (or "Your") shall mean an individual or Legal Entity
//       exercising permissions granted by this License.
//
//       "Source" form shall mean the preferred form for making modifications,
//       including but not limited to software source code, documentation
//       source, and configuration files.
//
//       "Object" form shall mean any form resulting from mechanical
//       transformation or translation of a Source form, including but
//       not limited to compiled object code, generated documentation,
//       and conversions to other media types.
//
//       "Work" shall mean the work of authorship, whether in Source or
//       Object form, made available under the License, as indicated by a
//       copyright notice that is included in or attached to the work
//       (an example is provided in the Appendix below).
//
//       "Derivative Works" shall mean any work, whether in Source or Object
//       form, that is based on (or derived from) the Work and for which the
//       editorial revisions, annotations, elaborations, or other modifications
//       represent, as a whole, an original work of authorship. For the purposes
//       of this License, Derivative Works shall not include works that remain
//       separable from, or merely link (or bind by name) to the interfaces of,
//       the Work and Derivative Works thereof.
//
//       "Contribution" shall mean any work of authorship, including
//       the original version of the Work and any modifications or additions
//       to that Work or Derivative Works thereof, that is intentionally
//       submitted to Licensor for inclusion in the Work by the copyright owner
//       or by an individual or Legal Entity authorized to submit on behalf of
//       the copyright owner. For the purposes of this definition, "submitted"
//       means any form of electronic, verbal, or written communication sent
//       to the Licensor or its representatives, including but not limited to
//       communication on electronic mailing lists, source code control systems,
//       and issue tracking systems that are managed by, or on behalf of, the
//       Licensor for the purpose of discussing and improving the Work, but
//       excluding communication that is conspicuously marked or otherwise
//       designated in writing by the copyright owner as "Not a Contribution."
//
//       "Contributor" shall mean Licensor and any individual or Legal Entity
//       on behalf of whom a Contribution has been received by Licensor and
//       subsequently incorporated within the Work.
//
//    2. Grant of Copyright License. Subject to the terms and conditions of
//       this License, each Contributor hereby grants to You a perpetual,
//       worldwide, non-exclusive, no-charge, royalty-free, irrevocable
//       copyright license to reproduce, prepare Derivative Works of,
//       publicly display, publicly perform, sublicense, and distribute the
//       Work and such Derivative Works in Source or Object form.
//
//    3. Grant of Patent License. Subject to the terms and conditions of
//       this License, each Contributor hereby grants to You a perpetual,
//       worldwide, non-exclusive, no-charge, royalty-free, irrevocable
//       (except as stated in this section) patent license to make, have made,
//       use, offer to sell, sell, import, and otherwise transfer the Work,
//       where such license applies only to those patent claims licensable
//       by such Contributor that are necessarily infringed by their
//       Contribution(s) alone or by combination of their Contribution(s)
//       with the Work to which such Contribution(s) was submitted. If You
//       institute patent litigation against any entity (including a
//       cross-claim or counterclaim in a lawsuit) alleging that the Work
//       or a Contribution incorporated within the Work constitutes direct
//       or contributory patent infringement, then any patent licenses
//       granted to You under this License for that Work shall terminate
//       as of the date such litigation is filed.
//
//    4. Redistribution. You may reproduce and distribute copies of the
//       Work or Derivative Works thereof in any medium, with or without
//       modifications, and in Source or Object form, provided that You
//       meet the following conditions:
//
//       (a) You must give any other recipients of the Work or
//           Derivative Works a copy of this License; and
//
//       (b) You must cause any modified files to carry prominent notices
//           stating that You changed the files; and
//
//       (c) You must retain, in the Source form of any Derivative Works
//           that You distribute, all copyright, patent, trademark, and
//           attribution notices from the Source form of the Work,
//           excluding those notices that do not pertain to any part of
//           the Derivative Works; and
//
//       (d) If the Work includes a "NOTICE" text file as part of its
//           distribution, then any Derivative Works that You distribute must
//           include a readable copy of the attribution notices contained
//           within such NOTICE file, excluding those notices that do not
//           pertain to any part of the Derivative Works, in at least one
//           of the following places: within a NOTICE text file distributed
//           as part of the Derivative Works; within the Source form or
//           documentation, if provided along with the Derivative Works; or,
//           within a display generated by the Derivative Works, if and
//           wherever such third-party notices normally appear. The contents
//           of the NOTICE file are for informational purposes only and
//           do not modify the License. You may add Your own attribution
//           notices within Derivative Works that You distribute, alongside
//           or as an addendum to the NOTICE text from the Work, provided
//           that such additional attribution notices cannot be construed
//           as modifying the License.
//
//       You may add Your own copyright statement to Your modifications and
//       may provide additional or different license terms and conditions
//       for use, reproduction, or distribution of Your modifications, or
//       for any such Derivative Works as a whole, provided Your use,
//       reproduction, and distribution of the Work otherwise complies with
//       the conditions stated in this License.
//
//    5. Submission of Contributions. Unless You explicitly state otherwise,
//       any Contribution intentionally submitted for inclusion in the Work
//       by You to the Licensor shall be under the terms and conditions of
//       this License, without any additional terms or conditions.
//       Notwithstanding the above, nothing herein shall supersede or modify
//       the terms of any separate license agreement you may have executed
//       with Licensor regarding such Contributions.
//
//    6. Trademarks. This License does not grant permission to use the trade
//       names, trademarks, service marks, or product names of the Licensor,
//       except as required for reasonable and customary use in describing the
//       origin of the Work and reproducing the content of the NOTICE file.
//
//    7. Disclaimer of Warranty. Unless required by applicable law or
//       agreed to in writing, Licensor provides the Work (and each
//       Contributor provides its Contributions) on an "AS IS" BASIS,
//       WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
//       implied, including, without limitation, any warranties or conditions
//       of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
//       PARTICULAR PURPOSE. You are solely responsible for determining the
//       appropriateness of using or redistributing the Work and assume any
//       risks associated with Your exercise of permissions under this License.
//
//    8. Limitation of Liability. In no event and under no legal theory,
//       whether in tort (including negligence), contract, or otherwise,
//       unless required by applicable law (such as deliberate and grossly
//       negligent acts) or agreed to in writing, shall any Contributor be
//       liable to You for damages, including any direct, indirect, special,
//       incidental, or consequential damages of any character arising as a
//       result of this License or out of the use or inability to use the
//       Work (including but not limited to damages for loss of goodwill,
//       work stoppage, computer failure or malfunction, or any and all
//       other commercial damages or losses), even if such Contributor
//       has been advised of the possibility of such damages.
//
//    9. Accepting Warranty or Additional Liability. While redistributing
//       the Work or Derivative Works thereof, You may choose to offer,
//       and charge a fee for, acceptance of support, warranty, indemnity,
//       or other liability obligations and/or rights consistent with this
//       License. However, in accepting such obligations, You may act only
//       on Your own behalf and on Your sole responsibility, not on behalf
//       of any other Contributor, and only if You agree to indemnify,
//       defend, and hold each Contributor harmless for any liability
//       incurred by, or claims asserted against, such Contributor by reason
//       of your accepting any such warranty or additional liability.
//
//    END OF TERMS AND CONDITIONS
//
//    APPENDIX: How to apply the Apache License to your work.
//
//       To apply the Apache License to your work, attach the following
//       boilerplate notice, with the fields enclosed by brackets "[]"
//       replaced with your own identifying information. (Don't include
//       the brackets!)  The text should be enclosed in the appropriate
//       comment syntax for the file format. We also recommend that a
//       file or class name and description of purpose be included on the
//       same "printed page" as the copyright notice for easier
//       identification within third-party archives.
//
//    Copyright 2021 Mario Sieg "pinsrq" <mt3000@gmx.de>
//
//    Licensed under the Apache License, Version 2.0 (the "License");
//    you may not use this file except in compliance with the License.
//    You may obtain a copy of the License at
//
//        http://www.apache.org/licenses/LICENSE-2.0
//
//    Unless required by applicable law or agreed to in writing, software
//    distributed under the License is distributed on an "AS IS" BASIS,
//    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//    See the License for the specific language governing permissions and
//    limitations under the License.

#[repr(usize)]
#[derive(Debug, Copy, Clone, Eq, PartialEq)]
#[allow(non_camel_case_types)]
pub enum Instruction {
    INT = 0x00,
    SYSCALL = 0x01,
    INTRIN = 0x02,
    CALL = 0x03,
    RET = 0x04,
    MOV = 0x05,
    STO = 0x06,
    PUSH = 0x07,
    POP = 0x08,
    POP2 = 0x09,
    DUPL = 0x0A,
    DUPL2 = 0x0B,
    SWAP = 0x0C,
    NOP = 0x0D,
    JMP = 0x0E,
    JMPR = 0x0F,
    JZ = 0x10,
    JNZ = 0x11,
    JOCMPI = 0x12,
    JOCMPF = 0x13,
    JNOCMPI = 0x14,
    JNOCMPF = 0x15,
    JECMPI = 0x16,
    JECMPF = 0x17,
    JNECMPI = 0x18,
    JNECMPF = 0x19,
    JACMPI = 0x1A,
    JACMPF = 0x1B,
    JLCMPI = 0x1C,
    JLCMPF = 0x1D,
    JAECMPI = 0x1E,
    JAECMPF = 0x1F,
    JLECMPI = 0x20,
    JLECMPF = 0x21,
    PUSHZ = 0x22,
    IPUSHO = 0x23,
    FPUSHO = 0x24,
    IINC = 0x25,
    IDEC = 0x26,
    IADD = 0x27,
    ISUB = 0x28,
    IMUL = 0x29,
    IDIV = 0x2A,
    IMOD = 0x2B,
    IAND = 0x2C,
    IOR = 0x2D,
    IXOR = 0x2E,
    ICOM = 0x2F,
    ISAL = 0x30,
    ISAR = 0x31,
    IROL = 0x32,
    IROR = 0x33,
    INEG = 0x34,
    FADD = 0x35,
    FSUB = 0x36,
    FMUL = 0x37,
    FDIV = 0x38,
    FMOD = 0x39,
    FNEG = 0x3A,
    FINC = 0x3B,
    FDEC = 0x3C,
    VPUSH = 0x3D,
    VPOP = 0x3E,
    VADD = 0x3F,
    VSUB = 0x40,
    VMUL = 0x41,
    VDIV = 0x42,
    MPUSH = 0x43,
    MPOP = 0x44,
    MADD = 0x45,
    MSUB = 0x46,
    MMUL = 0x47,
    MDIV = 0x48,
    CVTI2F = 0x49,
    CVTF2I = 0x4A,
    CVTI2C = 0x4B,
    CVTI2B = 0x4C,
    GCALLOC = 0x4D,
    DEREFW = 0x4E,
    DEREFR = 0x4F,

    /* count of total instructions */
    Count_,
}

impl Instruction {
    #[inline]
    pub fn mnemonic(&self) -> &'static str {
        Self::MNEMONIC_TABLE[*self as usize]
    }

    pub const MNEMONIC_TABLE: [&'static str; Self::Count_ as usize] = [
        "int", "syscall", "intrin", "call", "ret", "mov", "sto", "push", "pop", "pop2", "dupl",
        "dupl2", "swap", "nop", "jmp", "jmpr", "jz", "jnz", "jocmpi", "jocmpf", "jnocmpi",
        "jnocmpf", "jecmpi", "jecmpf", "jnecmpi", "jnecmpf", "jacmpi", "jacmpf", "jlcmpi",
        "jlcmpf", "jaecmpi", "jaecmpf", "jlecmpi", "jlecmpf", "pushz", "ipusho", "fpusho", "iinc",
        "idec", "iadd", "isub", "imul", "idiv", "imod", "iand", "ior", "ixor", "icom", "isal",
        "isar", "irol", "iror", "ineg", "fadd", "fsub", "fmul", "fdiv", "fmod", "fneg", "finc",
        "fdec", "vpush", "vpop", "vadd", "vsub", "vmul", "vdiv", "mpush", "mpop", "madd", "msub",
        "mmul", "mdiv", "cvti2f", "cvtf2i", "cvti2c", "cvti2b", "gcalloc", "derefw", "derefr",
    ];

    #[inline]
    pub fn category(&self) -> InstructionCategory {
        Self::CATEGORY_TABLE[*self as usize]
    }

    pub const CATEGORY_TABLE: [InstructionCategory; Self::Count_ as usize] = [
        /* int      */ InstructionCategory::Control,
        /* syscall  */ InstructionCategory::Control,
        /* intrin   */ InstructionCategory::Control,
        /* call     */ InstructionCategory::Control,
        /* ret      */ InstructionCategory::Control,
        /* mov      */ InstructionCategory::Memory,
        /* sto      */ InstructionCategory::Memory,
        /* push     */ InstructionCategory::Memory,
        /* pop      */ InstructionCategory::Memory,
        /* pop2     */ InstructionCategory::Memory,
        /* dupl     */ InstructionCategory::Memory,
        /* dupl2    */ InstructionCategory::Memory,
        /* swap     */ InstructionCategory::Memory,
        /* nop      */ InstructionCategory::Memory,
        /* jmp      */ InstructionCategory::Branching,
        /* jmprel   */ InstructionCategory::Branching,
        /* jz       */ InstructionCategory::Branching,
        /* jnz      */ InstructionCategory::Branching,
        /* jocmpi  */ InstructionCategory::Branching,
        /* jocmpf  */ InstructionCategory::Branching,
        /* jnocmpi */ InstructionCategory::Branching,
        /* jnocmpf */ InstructionCategory::Branching,
        /* jecmpi  */ InstructionCategory::Branching,
        /* jecmpf  */ InstructionCategory::Branching,
        /* jnecmpi */ InstructionCategory::Branching,
        /* jnecmpf */ InstructionCategory::Branching,
        /* jacmpi  */ InstructionCategory::Branching,
        /* jacmpf  */ InstructionCategory::Branching,
        /* jlcmpi  */ InstructionCategory::Branching,
        /* jlcmpf  */ InstructionCategory::Branching,
        /* jaecmpi */ InstructionCategory::Branching,
        /* jaecmpf */ InstructionCategory::Branching,
        /* jlecmpi */ InstructionCategory::Branching,
        /* jlecmpf */ InstructionCategory::Branching,
        /* pushz    */ InstructionCategory::Arithmetic,
        /* ipusho   */ InstructionCategory::Arithmetic,
        /* fpusho   */ InstructionCategory::Arithmetic,
        /* iinc     */ InstructionCategory::Arithmetic,
        /* idec     */ InstructionCategory::Arithmetic,
        /* iadd     */ InstructionCategory::Arithmetic,
        /* isub     */ InstructionCategory::Arithmetic,
        /* imul     */ InstructionCategory::Arithmetic,
        /* idiv     */ InstructionCategory::Arithmetic,
        /* imod     */ InstructionCategory::Arithmetic,
        /* iand     */ InstructionCategory::Bitwise,
        /* ior      */ InstructionCategory::Bitwise,
        /* ixor     */ InstructionCategory::Bitwise,
        /* icom     */ InstructionCategory::Bitwise,
        /* isal     */ InstructionCategory::Bitwise,
        /* isar     */ InstructionCategory::Bitwise,
        /* irol     */ InstructionCategory::Bitwise,
        /* iror     */ InstructionCategory::Bitwise,
        /* ineg     */ InstructionCategory::Bitwise,
        /* fadd     */ InstructionCategory::Arithmetic,
        /* fsub     */ InstructionCategory::Arithmetic,
        /* fmul     */ InstructionCategory::Arithmetic,
        /* fdiv     */ InstructionCategory::Arithmetic,
        /* fmod     */ InstructionCategory::Arithmetic,
        /* fneg     */ InstructionCategory::Arithmetic,
        /* finc     */ InstructionCategory::Arithmetic,
        /* fdec     */ InstructionCategory::Arithmetic,
        /* vpush    */ InstructionCategory::Memory,
        /* vpop     */ InstructionCategory::Memory,
        /* vadd     */ InstructionCategory::VectorArithmetic,
        /* vsub     */ InstructionCategory::VectorArithmetic,
        /* vmul     */ InstructionCategory::VectorArithmetic,
        /* vdiv     */ InstructionCategory::VectorArithmetic,
        /* mpush    */ InstructionCategory::Memory,
        /* mpop     */ InstructionCategory::Memory,
        /* madd     */ InstructionCategory::VectorArithmetic,
        /* msub     */ InstructionCategory::VectorArithmetic,
        /* mmul     */ InstructionCategory::VectorArithmetic,
        /* mdiv     */ InstructionCategory::VectorArithmetic,
        /* cvti2f   */ InstructionCategory::Memory,
        /* cvtf2i   */ InstructionCategory::Memory,
        /* cvti2c   */ InstructionCategory::Memory,
        /* cvti2b   */ InstructionCategory::Memory,
        /* gcalloc  */ InstructionCategory::Memory,
        /* derefw   */ InstructionCategory::Memory,
        /* derefr   */ InstructionCategory::Memory,
    ];

    #[inline]
    pub fn push_count(&self) -> u8 {
        Self::PUSH_RECORD_TABLE[*self as usize]
    }

    pub const PUSH_RECORD_TABLE: [u8; Self::Count_ as usize] = [
        /* int      */ 0, /* syscall  */ 0, /* intrin   */ 0, /* call     */ 0,
        /* ret      */ 0, /* mov      */ 0, /* sto      */ 0, /* push     */ 1,
        /* pop      */ 0, /* pop2     */ 0, /* dupl     */ 1, /* dupl2    */ 2,
        /* swap     */ 2, /* nop      */ 0, /* jmp      */ 0, /* jmprel   */ 0,
        /* jz       */ 0, /* jnz      */ 0, /* jocmpi  */ 0, /* jocmpf  */ 0,
        /* jnocmpi */ 0, /* jnocmpf */ 0, /* jecmpi  */ 0, /* jecmpf  */ 0,
        /* jnecmpi */ 0, /* jnecmpf */ 0, /* jacmpi  */ 0, /* jacmpf  */ 0,
        /* jlcmpi  */ 0, /* jlcmpf  */ 0, /* jaecmpi */ 0, /* jaecmpf */ 0,
        /* jlecmpi */ 0, /* jlecmpf */ 0, /* pushz    */ 1, /* ipusho   */ 1,
        /* fpusho   */ 1, /* iinc     */ 1, /* idec     */ 1, /* iadd     */ 1,
        /* isub     */ 1, /* imul     */ 1, /* idiv     */ 1, /* imod     */ 1,
        /* iand     */ 1, /* ior      */ 1, /* ixor     */ 1, /* icom     */ 1,
        /* isal     */ 1, /* isar     */ 1, /* irol     */ 1, /* iror     */ 1,
        /* ineg     */ 1, /* fadd     */ 1, /* fsub     */ 1, /* fmul     */ 1,
        /* fdiv     */ 1, /* fmod     */ 1, /* fneg     */ 1, /* finc     */ 1,
        /* fdec     */ 1, /* vpush    */ 4, /* vpop     */ 0, /* vadd     */ 4,
        /* vsub     */ 4, /* vmul     */ 4, /* vdiv     */ 4,
        /* mpush    */ 16, /* mpop     */ 0, /* madd     */ 16,
        /* msub     */ 16, /* mmul     */ 16, /* mdiv     */ 16,
        /* cvti2f   */ 1, /* cvtf2i   */ 1, /* cvti2c   */ 1, /* cvti2b   */ 1,
        /* gcalloc  */ 1, /* derefw   */ 0, /* derefr   */ 1,
    ];

    #[inline]
    pub fn pop_count(&self) -> u8 {
        Self::POP_RECORD_TABLE[*self as usize]
    }

    pub const POP_RECORD_TABLE: [u8; Self::Count_ as usize] = [
        /* int      */ 0, /* syscall  */ 0, /* intrin   */ 0, /* call     */ 0,
        /* ret      */ 1, /* mov      */ 0, /* sto      */ 0, /* push     */ 0,
        /* pop      */ 1, /* pop2     */ 2, /* dupl     */ 0, /* dupl2    */ 0,
        /* swap     */ 2, /* nop      */ 0, /* jmp      */ 0, /* jmprel   */ 0,
        /* jz       */ 1, /* jnz      */ 1, /* jocmpi  */ 1, /* jocmpf  */ 1,
        /* jnocmpi */ 1, /* jnocmpf */ 1, /* jecmpi  */ 2, /* jecmpf  */ 2,
        /* jnecmpi */ 2, /* jnecmpf */ 2, /* jacmpi  */ 2, /* jacmpf  */ 2,
        /* jlcmpi  */ 2, /* jlcmpf  */ 2, /* jaecmpi */ 2, /* jaecmpf */ 2,
        /* jlecmpi */ 2, /* jlecmpf */ 2, /* pushz    */ 0, /* ipusho   */ 0,
        /* fpusho   */ 1, /* iinc     */ 1, /* idec     */ 1, /* iadd     */ 2,
        /* isub     */ 2, /* imul     */ 2, /* idiv     */ 2, /* imod     */ 2,
        /* iand     */ 2, /* ior      */ 2, /* ixor     */ 2, /* icom     */ 1,
        /* isal     */ 2, /* isar     */ 2, /* irol     */ 2, /* iror     */ 2,
        /* ineg     */ 1, /* fadd     */ 2, /* fsub     */ 2, /* fmul     */ 2,
        /* fdiv     */ 2, /* fmod     */ 2, /* fneg     */ 1, /* finc     */ 1,
        /* fdec     */ 1, /* vpush    */ 0, /* vpop     */ 4, /* vadd     */ 8,
        /* vsub     */ 8, /* vmul     */ 8, /* vdiv     */ 8, /* mpush    */ 0,
        /* mpop     */ 16, /* madd     */ 32, /* msub     */ 32,
        /* mmul     */ 32, /* mdiv     */ 32, /* cvti2f   */ 1,
        /* cvtf2i   */ 1, /* cvti2c   */ 1, /* cvti2b   */ 1, /* gcalloc  */ 0,
        /* derefw   */ 1, /* derefr   */ 0,
    ];

    #[inline]
    pub fn arg_count(&self) -> u8 {
        Self::ARGUMENT_COUNT_TABLE[*self as usize]
    }

    pub const ARGUMENT_COUNT_TABLE: [u8; Self::Count_ as usize] = [
        /* int      */ 1, /* syscall  */ 1, /* intrin   */ 1, /* call     */ 1,
        /* ret      */ 0, /* mov      */ 2, /* sto      */ 2, /* push     */ 1,
        /* pop      */ 0, /* pop2     */ 0, /* dupl     */ 0, /* dupl2    */ 0,
        /* swap     */ 0, /* nop      */ 0, /* jmp      */ 1, /* jmprel   */ 1,
        /* jz       */ 1, /* jnz      */ 1, /* jocmpi  */ 1, /* jocmpf  */ 1,
        /* jnocmpi */ 1, /* jnocmpf */ 1, /* jecmpi  */ 1, /* jecmpf  */ 1,
        /* jnecmpi */ 1, /* jnecmpf */ 1, /* jacmpi  */ 1, /* jacmpf  */ 1,
        /* jlcmpi  */ 1, /* jlcmpf  */ 1, /* jaecmpi */ 1, /* jaecmpf */ 1,
        /* jlecmpi */ 1, /* jlecmpf */ 1, /* pushz    */ 0, /* ipusho   */ 0,
        /* fpusho   */ 0, /* iinc     */ 0, /* idec     */ 0, /* iadd     */ 0,
        /* isub     */ 0, /* imul     */ 0, /* idiv     */ 0, /* imod     */ 0,
        /* iand     */ 0, /* ior      */ 0, /* ixor     */ 0, /* icom     */ 0,
        /* isal     */ 0, /* isar     */ 0, /* irol     */ 0, /* iror     */ 0,
        /* ineg     */ 0, /* fadd     */ 0, /* fsub     */ 0, /* fmul     */ 0,
        /* fdiv     */ 0, /* fmod     */ 0, /* fneg     */ 0, /* finc     */ 0,
        /* fdec     */ 0, /* vpush    */ 4, /* vpop     */ 0, /* vadd     */ 0,
        /* vsub     */ 0, /* vmul     */ 0, /* vdiv     */ 0,
        /* mpush    */ 16, /* mpop     */ 0, /* madd     */ 0,
        /* msub     */ 0, /* mmul     */ 0, /* mdiv     */ 0, /* cvti2f   */ 0,
        /* cvtf2i   */ 0, /* cvti2c   */ 0, /* cvti2b   */ 0, /* gcalloc  */ 1,
        /* derefw   */ 1, /* derefr   */ 1,
    ];

    #[inline]
    pub fn description(&self) -> &'static str {
        Self::DESCRIPTOR_TABLE[*self as usize]
    }

    pub const DESCRIPTOR_TABLE: [&'static str; Self::Count_ as usize] = [
        /* int      */ "interrupt reactor execution",
        /* syscall  */ "call intrinsic system routine",
        /* intrin   */ "call custom intrinsic routine",
        /* call     */ "call procedure",
        /* ret      */ "return from procedure",
        /* mov      */ "copy stack slot to stack record",
        /* sto      */ "copy immediate to stack record",
        /* push     */ "push one stack record onto stack",
        /* pop      */ "pop one stack record from stack",
        /* pop2     */ "pop two records from stack",
        /* dupl     */ "duplicate stack top",
        /* dupl2    */ "duplicate stack top two times",
        /* swap     */ "swap the stack top slot with the lower slot",
        /* nop      */ "no operation",
        /* jmp      */ "absolute direct unconditional jump",
        /* jmprel   */ "relative indirect jump unconditional jump",
        /* jz       */ "jump if zero",
        /* jnz      */ "jump if not zero",
        /* jocmpi  */ "jump if one - compare as int",
        /* jocmpf  */ "jump if one - compare as float",
        /* jnocmpi */ "jump if not one - compare as int",
        /* jnocmpf */ "jump if not one - compare as  int",
        /* jecmpi  */ "jump if equal as int",
        /* jecmpf  */ "jump if equal - compare as F32ing point",
        /* jnecmpi */ "jump if not equal - compare  as int",
        /* jnecmpf */ "jump if not equal - compare  as F32ing point",
        /* jacmpi  */ "jump if above - compare  as int",
        /* jacmpf  */ "jump if above - compare  as F32ing point",
        /* jlcmpi  */ "jump if less - compare as F32ing point",
        /* jlcmpf  */ "jump if less - compare as F32ing point",
        /* jaecmpi */ "jump if above or equal - compare as int",
        /* jaecmpf */ "jump if above or equal - compare as F32ing point",
        /* jlecmpi */ "jump if less or equal - compare as int",
        /* jlecmpf */ "jump if less or equal - compare as F32ing point",
        /* pushz    */ "push zero as int",
        /* ipusho   */ "push one as  int",
        /* fpusho   */ "push one as F32ing point",
        /* iinc     */ "int increment",
        /* idec     */ "int decrement",
        /* iadd     */ "int addition",
        /* isub     */ "int subtraction",
        /* imul     */ "int multiplication",
        /* idiv     */ "int division",
        /* imod     */ "int remainder",
        /* iand     */ "int bitwise and",
        /* ior      */ "int bitwise or",
        /* ixor     */ "int bitwise xor",
        /* icom     */ "int bitwise complement",
        /* isal     */ "int bitwise arithmetic left shift",
        /* isar     */ "int bitwise arithmetic right shift",
        /* irol     */ "int bitwise rotation left",
        /* iror     */ "int bitwise right rotation",
        /* ineg     */ "int negation",
        /* fadd     */ "float addition",
        /* fsub     */ "float subtraction",
        /* fmul     */ "float multiplication",
        /* fdiv     */ "float division",
        /* fmod     */ "float remainder",
        /* fneg     */ "float negation",
        /* finc     */ "float increment",
        /* fdec     */ "float decrement",
        /* vpush    */ "push vector4",
        /* vpop     */ "pop vector4",
        /* vadd     */ "simd float vector4 addition",
        /* vsub     */ "simd float vector4 subtraction",
        /* vmul     */ "simd float vector4 multiplication",
        /* vdiv     */ "simd float vector4 division",
        /* mpush    */ "push matrix4x4",
        /* mpop     */ "pop matrix4x4 ",
        /* madd     */ "simd float matrix4x4 matrix addition",
        /* msub     */ "simd float matrix4x4 matrix subtraction",
        /* mmul     */ "simd float matrix4x4 matrix multiplication",
        /* mdiv     */ "simd float matrix4x4 matrix division",
        /* cvti2f   */ "convert int to float",
        /* cvtf2i   */ "convert float to int",
        /* cvti2c   */ "convert int to char",
        /* cvti2b   */ "convert int to bool",
        /* gcalloc  */ "allocate garbage collected object",
        /* derefw   */ "dereference and write field from stack top",
        /* derefr   */ "dereference and read field to stack top",
    ];
}

#[repr(u8)]
#[derive(Debug, Copy, Clone, Eq, PartialEq)]
pub enum InstructionCategory {
    Control = 0x00,
    Memory = 0x01,
    Branching = 0x02,
    Arithmetic = 0x03,
    Bitwise = 0x04,
    VectorArithmetic = 0x05,
    Count_,
}

#[repr(usize)]
#[derive(Debug, Copy, Clone, Eq, PartialEq)]
#[allow(non_camel_case_types)]
pub enum Syscall {
    COS = 0x00,
    SIN = 0x01,
    TAN = 0x02,
    ACOS = 0x03,
    ASIN = 0x04,
    ATAN = 0x05,
    ATAN2 = 0x06,
    COSH = 0x07,
    SINH = 0x08,
    TANH = 0x09,
    ACOSH = 0x0A,
    ASINH = 0x0B,
    ATANH = 0x0C,
    EXP = 0x0D,
    LOG = 0x0E,
    LOG10 = 0x0F,
    EXP2 = 0x10,
    ILOGB = 0x11,
    LOG2 = 0x12,
    POW = 0x13,
    SQRT = 0x14,
    CBRT = 0x15,
    HYPOT = 0x16,
    CEIL = 0x17,
    FLOOR = 0x18,
    ROUND = 0x19,
    RINT = 0x1A,
    IMAX = 0x1B,
    IMIN = 0x1C,
    FMAX = 0x1D,
    FMIN = 0x1E,
    FDIM = 0x1F,
    IABS = 0x20,
    FABS = 0x21,
    PRINT_INT = 0x22,
    PRINT_FLOAT = 0x23,
    PRINT_CHAR = 0x24,
    PRINT_BOOL = 0x25,
    FLUSH = 0x26,
    NEWLINE = 0x27,

    /* !no intrinsic routine - count of total intrinsic routines! */
    Count_,
}

pub type MemoryOffset = usize;

pub type JumpAddress = usize;

pub type Intrinsic = usize;

pub type TypeID = usize;

pub type FieldOffset = usize;

pub type LabelID = usize;

pub type Opcode = usize;
